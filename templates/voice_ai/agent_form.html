{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ title }}</h1>
</div>

<form method="POST" class="agent-form">
    {{ form.hidden_tag() }}

    <div class="form-section">
        <h3>Grundeinstellungen</h3>

        <div class="form-group">
            {{ form.name.label }}
            {{ form.name(class="form-control", placeholder="z.B. Sales Agent DE") }}
            {% for error in form.name.errors %}
            <span class="error">{{ error }}</span>
            {% endfor %}
        </div>

        <div class="form-row">
            <div class="form-group">
                {{ form.provider.label }}
                {{ form.provider(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.primary_language.label }}
                {{ form.primary_language(class="form-control") }}
            </div>
        </div>

        <div class="form-group">
            {{ form.api_key.label }}
            {{ form.api_key(class="form-control", type="password", placeholder="Provider API Key") }}
            <small class="form-help">API Key für den gewählten Provider</small>
        </div>
    </div>

    <div class="form-section">
        <h3>Stimme & Sprache</h3>

        <div class="form-row">
            <div class="form-group">
                {{ form.tts_provider.label }}
                {{ form.tts_provider(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.tts_voice_id.label }}
                {{ form.tts_voice_id(class="form-control", placeholder="Voice ID") }}
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                {{ form.stt_provider.label }}
                {{ form.stt_provider(class="form-control") }}
            </div>
        </div>

        <div class="voice-recommendations">
            <h4>Empfohlene Stimmen</h4>
            <table class="table table-sm">
                <tr>
                    <td><strong>Deutsch (ElevenLabs)</strong></td>
                    <td>Adam: <code>pNInz6obpgDQGcFmaJgB</code></td>
                </tr>
                <tr>
                    <td><strong>Bosnisch/Serbisch (Azure)</strong></td>
                    <td><code>bs-BA-VesnaNeural</code> / <code>sr-RS-SophieNeural</code></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="form-section">
        <h3>KI-Modell</h3>

        <div class="form-row">
            <div class="form-group">
                {{ form.llm_provider.label }}
                {{ form.llm_provider(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.llm_model.label }}
                {{ form.llm_model(class="form-control") }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Telefonie</h3>

        <div class="form-row">
            <div class="form-group">
                {{ form.telephony_provider.label }}
                {{ form.telephony_provider(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.phone_number.label }}
                {{ form.phone_number(class="form-control", placeholder="+49...") }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Sales Script (System Prompt)</h3>

        <div class="prompt-presets">
            <button type="button" class="btn btn-sm" onclick="setPrompt('de')">Deutsch</button>
            <button type="button" class="btn btn-sm" onclick="setPrompt('bs')">Bosnisch</button>
            <button type="button" class="btn btn-sm" onclick="setPrompt('sr')">Serbisch</button>
        </div>

        <div class="form-group">
            {{ form.system_prompt(class="form-control", rows=15) }}
            <small class="form-help">
                Hier definierst du, wie der Agent spricht und verkauft.
                Wichtig: Natürliche Sprache mit Füllwörtern verwenden!
            </small>
        </div>
    </div>

    <div class="form-section">
        <div class="form-group checkbox-group">
            {{ form.is_active() }}
            {{ form.is_active.label }}
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary btn-lg">
            {% if agent %}Agent aktualisieren{% else %}Agent erstellen{% endif %}
        </button>
        <a href="{{ url_for('voice_ai.agent_list') }}" class="btn btn-secondary">Abbrechen</a>
    </div>
</form>

<script>
const prompts = {
    'de': `Du bist ein freundlicher Verkaufsberater. Sprich natürlich wie ein Mensch.

WICHTIG - Klinge menschlich:
- Nutze Füllwörter: "also", "ähm", "ja genau", "wissen Sie was"
- Mache kurze Pausen beim Nachdenken
- Reagiere empathisch auf Einwände
- Stelle Rückfragen
- Sprich in kurzen, natürlichen Sätzen

VERMEIDE:
- Roboter-Phrasen wie "Ich werde nun..."
- Zu formelle Sprache
- Lange Monologe

DEIN ZIEL:
1. Begrüße freundlich und persönlich
2. Finde heraus, was der Kunde braucht
3. Präsentiere die passende Lösung
4. Bearbeite Einwände einfühlsam
5. Schließe mit klarem nächsten Schritt ab`,

    'bs': `Ti si prijateljski prodajni savjetnik. Govori prirodno kao čovjek.

VAŽNO - Zvuči ljudski:
- Koristi poštapalice: "znači", "ovaj", "eto", "ma da"
- Pravi kratke pauze dok razmišljaš
- Reaguj empatično na prigovore
- Postavljaj potpitanja
- Govori kratkim, prirodnim rečenicama

IZBJEGAVAJ:
- Robot fraze kao "Sada ću..."
- Previše formalnog jezika
- Duge monologe`,

    'sr': `Ти си пријатељски продајни саветник. Говори природно као човек.

ВАЖНО - Звучи људски:
- Користи поштапалице: "значи", "овај", "ето", "ма да"
- Прави кратке паузе док размишљаш
- Реагуј емпатично на приговоре
- Постављај потпитања
- Говори кратким, природним реченицама`
};

function setPrompt(lang) {
    document.getElementById('system_prompt').value = prompts[lang];
}
</script>

<style>
.agent-form {
    max-width: 800px;
}
.form-section {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.form-section h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-color);
}
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}
.voice-recommendations {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 6px;
    margin-top: 1rem;
}
.voice-recommendations h4 {
    margin: 0 0 0.5rem 0;
    font-size: 0.9rem;
}
.voice-recommendations code {
    background: #e9ecef;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.85rem;
}
.prompt-presets {
    margin-bottom: 0.5rem;
}
.prompt-presets .btn {
    margin-right: 0.5rem;
}
.checkbox-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}
</style>
{% endblock %}
